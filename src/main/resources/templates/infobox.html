<!--

    Skill Circuits
    Copyright (C) 2022 - Delft University of Technology

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!DOCTYPE html>
<html
    lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <div th:fragment="infobox" th:if="${studentAndAuthenticated} and ${state} != 'hidden'">
        <div
            id="info-box"
            class="info-box"
            th:aria-expanded="${state} == 'collapsed' ? 'false' : 'true'">
            <div id="info-text" class="info-text">
                <a
                    class="larger-info"
                    th:if="${completedSomeTask}"
                    th:href="@{|/module/${moduleId}#block-${skillId}-name|}"
                    th:text="'Last worked on: ' + ${latestTask.getName()}"></a>
                <a
                    class="smaller-info"
                    th:if="${completedSomeTask}"
                    th:href="@{|/module/${moduleId}#block-${skillId}-name|}"
                    th:text="'In ' + ${locationString}"></a>
                <span class="default-info" th:unless="${completedSomeTask}">
                    After you complete a task, it will appear here!
                </span>
            </div>
            <div class="icons">
                <a
                    th:if="${completedSomeTask}"
                    class="map-icon fa-solid fa-map-location-dot"
                    th:href="@{|/module/${moduleId}#block-${skillId}-name|}"></a>
                <i
                    th:unless="${completedSomeTask}"
                    class="map-icon fa-solid fa-map-location-dot"></i>
                <i id="arrow-icon" class="arrow-icon fa-solid fa-angle-left"></i>
            </div>
        </div>
        <script>
            $(document).ready(function () {
                const infoBox = $("#info-box");
                const infoText = $("#info-text");
                const mapIcon = $(".map-icon");

                // Handling of hover effects for map icon
                const largerMap = function () {
                    if (infoText.has("a").length !== 0) {
                        mapIcon.css("transform", "scale(1.15, 1.15)");
                    }
                };
                const smallerMap = function () {
                    mapIcon.css("transform", "scale(1, 1)");
                };
                infoText.children().hover(largerMap, smallerMap);
                mapIcon.hover(largerMap, smallerMap);

                // Handling of collapsing/expanding box
                const collapseOrExpand = () => {
                    if (infoBox.attr("aria-expanded") === "true") {
                        localStorage.setItem("infoboxState", "COLLAPSED");
                        infoBox.attr("aria-expanded", "false");
                    } else {
                        localStorage.setItem("infoboxState", "EXPANDED");
                        infoBox.attr("aria-expanded", "true");
                    }
                };
                $("#arrow-icon").click(collapseOrExpand);
            });
        </script>
    </div>
</html>
