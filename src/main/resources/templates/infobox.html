<!--

    Skill Circuits
    Copyright (C) 2022 - Delft University of Technology

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!DOCTYPE html>
<html
    lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <!-- TODO Might need to find a better way to retrieve the needed information
            Also, currently, authorisationService.isStaff() does not check whether the person is
            authenticated, so the below condition is only safe if the operators and/or are using
            short-circuit evaluation -->
    <div
        layout:fragment="infobox"
        th:if="${@taskCompletionService.latestTaskCompletion(@authorisationService.getAuthPerson())} != null and
                ${@authorisationService.isAuthenticated()} and
                (${studentMode} or not ${@authorisationService.isStaff()})">
        <div
            id="info-box"
            th:with="task=${@taskCompletionService.latestTaskCompletion(
            @authorisationService.getAuthPerson())},
            moduleId=${task.getSkill().getSubmodule().getModule().getId()}">
            <div id="info-text" style="display: flex">
                <a
                    class="larger-info"
                    th:href="@{|/module/${moduleId}|}"
                    th:text="'Last worked on: ' + ${task.getName()}"></a>
                <a
                    class="smaller-info"
                    th:href="@{|/module/${moduleId}|}"
                    th:text="'In ' + ${@taskCompletionService.getLocationString(task)}"></a>
            </div>
            <div id="icons">
                <i id="map-icon" class="fa-solid fa-map-location-dot"></i>
                <i id="arrow-icon" class="fa-solid fa-angle-left"></i>
            </div>
        </div>

        <script>
            const rightArrowClass = "fa-angle-right";
            const leftArrowClass = "fa-angle-left";

            document.addEventListener("DOMContentLoaded", function () {
                const infoText = $("#info-text");
                const arrow = $("#arrow-icon");

                let collapseOrExpand = () => {
                    if (infoText.css("display") === "flex") {
                        infoText.css("display", "none");
                        arrow.removeClass(leftArrowClass);
                        arrow.addClass(rightArrowClass);
                    } else {
                        infoText.css("display", "flex");
                        arrow.removeClass(rightArrowClass);
                        arrow.addClass(leftArrowClass);
                    }
                };

                arrow.click(collapseOrExpand);
            });
        </script>
    </div>
</html>
