<!--

    Skill Circuits
    Copyright (C) 2022 - Delft University of Technology

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!DOCTYPE html>
<html
        lang="en"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<!--th:style="|grid-row: ${block.row + 1}; grid-column: ${block.column + 1}|"-->
<div
        th:id="|block-${block.id}-overlay|"
        class="bloated hidden"

        th:data-group="${group.id}"
        th:data-create="${create}"

        th:data-essential="${level == 'module'} ? ${block.essential} : ${null}"
        th:data-hidden="${level == 'module'} ? ${canEdit and block.hidden} : ${null}"
        th:data-checkpoint="${level == 'module'} ? ${block.checkpoint.id} : ${null}"
        layout:fragment="bloated"
        th:if="${level == 'module'and not canEdit}">
<!--        th:if="${level != 'module'} or ${block.completedRequiredTasks or canEdit or not block.hidden}"-->



    <div th:id="|block-${block.id}-header|" class="block__header">
        <p
                th:id="|block-${block.id}-group|"
                class="block__group__name"
                th:text="${group.name}"></p>
        <h2 class="block__name">
            <span th:id="|block-${block.id}-name|" th:text="${block.name}"></span>
        </h2>
    </div>

    <div class="skill-paths">
        <div>
            <p style="color:gray">Your path</p><!--TODO: do proper color styling, display path name before editing -->
            <ul data-edit="always" class="items">
                <h3 style="font-size: 0.8rem" th:if="${block.items.size() == 0}">
                    This skill has no tasks in this path
                </h3>

                <th:block th:each="item, iter : ${block.items}">
                    <th:block> <!--       TODO: remove this ?         -->
                        <li layout:replace="~{task/view :: item}"></li>
                    </th:block>
                </th:block>
            </ul>
        </div>
        <div>
            <p style="color:gray">Other Paths</p>
            <th:block th:each="path : ${@editionService.getPaths(circuit.edition.id)}">
                    <li layout:replace="~{path/view :: path}"></li>
            </th:block>
        </div>
    </div>

    <span class="block__info" th:if="${not block.essential}">
            Optional
    </span>

</div>

    <th:block layout:fragment="script">
        <div layout:replace="~{path/view :: script}"></div>

        <script>
        // function mouseEnterGroup() {
        //     let submoduleId = $(this).parent().parent().data("group");
        //     $(`.block[data-group='${submoduleId}']`).addClass("highlighted");
        // }
        // function mouseLeaveGroup() {
        //     $(".block").removeClass("highlighted");
        // }

        // document.addEventListener("DOMContentLoaded", function () {
        //     let groupName = $(".block__group__name");
        //     groupName.mouseenter(mouseEnterGroup);
        //     groupName.mouseleave(mouseLeaveGroup);
        // });

       // functions for overlay
        function openBloatedSkill() {
            // toggleOverlay("block-overlay");

            let blockId = $(this).data("id");
            // $("block-"+blockId+"-overlay").removeClass("hidden");
            $(`#block-${blockId}-overlay`).removeClass("hidden");
            console.log(blockId);
            console.log($(`#block-${blockId}-overlay`));

            $("#block-id").val(blockId);
            $("#block-name").text($(`#block-${blockId}-name`).text());
        }

        document.addEventListener("DOMContentLoaded", function() {
            $(".block").click(openBloatedSkill); // TODO add skill id
        });

        </script>
    </th:block>
</html>
