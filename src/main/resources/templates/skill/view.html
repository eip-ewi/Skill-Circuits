<!--

    Skill Circuits
    Copyright (C) 2022 - Delft University of Technology

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<div th:id="|skill-${skill.id}|" class="skill"
     th:style="|grid-row: ${skill.row + 1}; grid-column: ${skill.column + 1}|"
     th:draggable="${@authorisationService.canEditSkillInEdition(module.edition.id)}"
     th:classappend="${@authorisationService.canEditSkillInEdition(module.edition.id)} ? 'draggable' : ''"
     th:data-submodule="${submodule.id}"
     th:data-essential="${skill.essential}"
     th:with="childIds = ${skill instanceof T(nl.tudelft.skills.model.Skill)} ? ${{}} : ${skill.childIds}"
     th:data-children="${childIds}"
     layout:fragment="block">
    <div th:id="|skill-${skill.id}-header|" class="skill__header">
        <h2 class="skill__name">
            <span th:id="|skill-${skill.id}-name|" th:text="${skill.name}"></span>
        </h2>
        <p th:id="|skill-${skill.id}-submodule|" class="skill__submodule__name" th:text="${submodule.name}"></p>
    </div>

    <ul class="tasks">
        <th:block th:each="task : ${skill.tasks}">
            <li layout:replace="~{task/view :: item}"></li>
        </th:block>
        <li th:if="${@authorisationService.canEditSkill(skill.id)}">
            <button th:id="|create-task-${skill.id}-button|" class="task__create fa-solid fa-plus" th:data-skill="${skill.id}"></button>
        </li>
    </ul>

    <div class="skill__buttons">
        <button class="fa-solid fa-pen skill__edit"
                th:if="${@authorisationService.canEditSkill(skill.id)}"
                th:data-skill="${skill.id}"></button>
        <button class="fa-solid fa-trash skill__delete"
                th:if="${@authorisationService.canDeleteSkill(skill.id)}"
                th:data-skill="${skill.id}"></button>
    </div>
</div>

<script layout:fragment="script">
    document.addEventListener("DOMContentLoaded", function () {
        $(".skill__submodule__name").mouseenter(function (){
            let submoduleId = $(this).parent().parent().data("group");
            $(`.skill[data-group='${submoduleId}']`).addClass("highlighted");
        });

        $(".skill__submodule__name").mouseleave(function (){
            $(".skill").removeClass("highlighted");
        });
    });
</script>

</html>