<!--

    Skill Circuits
    Copyright (C) 2022 - Delft University of Technology

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!DOCTYPE html>
<html
    lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{container}">
    <head>
        <link rel="stylesheet" th:href="@{/css/blocks.css}" />

        <title>Skill Circuits</title>
    </head>

    <body>
        <div
            layout:fragment="content"
            th:with="displayOwn = !${#lists.isEmpty(ownActive)} or !${#lists.isEmpty(ownFinished)} or !${#lists.isEmpty(managed)},
                        displayAvailable = !${#lists.isEmpty(availableActive)} or !${#lists.isEmpty(availableFinished)}">
            <h1>Welcome to Skill Circuits</h1>

            <!-- TODO check if this should be a form, only display if needed, show currently selected visually -->
            <div class="tabs">
                <button class="tab" onclick="setCourseView('own')" type="button" th:if="displayOwn">
                    Your Courses
                </button>
                <button
                    class="tab"
                    onclick="setCourseView('available')"
                    type="button"
                    th:if="displayAvailable">
                    Available Courses
                </button>
            </div>

            <!-- TODO display information text if no courses available at all, or no own courses etc. -->
            <!-- TODO add some spacing between elements -->

            <!-- Own courses -->
            <div id="own-courses" th:if="displayOwn">
                <h2 th:if="!${#lists.isEmpty(ownActive)}">Active courses</h2>
                <div class="blocks" th:if="!${#lists.isEmpty(ownActive)}">
                    <th:block th:each="course : ${ownActive}">
                        <th:block>
                            <a
                                class="block"
                                th:href="@{|/edition/${@courseService.getLastStudentEditionForCourseOrLast(course.id)}|}">
                                <h2 th:text="${course.code}"></h2>
                                <h2 th:text="${course.name}"></h2>
                                <h3
                                    style="font-size: 0.8rem"
                                    th:text="|${completedSkillsPerCourse.get(course.id)} / ${@skillRepository.countBySubmoduleModuleEditionId(@courseService.getLastStudentEditionForCourseOrLast(course.id))} skills completed|"></h3>
                            </a>
                        </th:block>
                    </th:block>
                </div>

                <h2 th:if="!${#lists.isEmpty(ownFinished)}">Finished courses</h2>
                <div class="blocks" th:if="!${#lists.isEmpty(ownFinished)}">
                    <th:block th:each="course : ${ownFinished}">
                        <th:block>
                            <a
                                class="block"
                                th:href="@{|/edition/${@courseService.getLastStudentEditionForCourseOrLast(course.id)}|}">
                                <h2 th:text="${course.code}"></h2>
                                <h2 th:text="${course.name}"></h2>
                                <h3
                                    style="font-size: 0.8rem"
                                    th:text="|${completedSkillsPerCourse.get(course.id)} / ${@skillRepository.countBySubmoduleModuleEditionId(@courseService.getLastStudentEditionForCourseOrLast(course.id))} skills completed|"></h3>
                            </a>
                        </th:block>
                    </th:block>
                </div>

                <h2 th:if="!${#lists.isEmpty(managed)}">Managed courses</h2>
                <div class="blocks" th:if="!${#lists.isEmpty(managed)}">
                    <th:block th:each="course : ${managed}">
                        <th:block>
                            <a class="block" th:href="@{|/course/${course.id}|}">
                                <h2 th:text="${course.code}"></h2>
                                <h2 th:text="${course.name}"></h2>
                                <h3
                                    style="font-size: 0.8rem"
                                    th:text="|${@courseService.getNumberOfEditions(course.id)} editions|"></h3>
                            </a>
                        </th:block>
                    </th:block>
                </div>
            </div>

            <!-- Available courses -->
            <div
                id="available-courses"
                th:if="displayAvailable"
                aria-hidden="true"
                style="display: none">
                <h2 th:if="!${#lists.isEmpty(availableActive)}">Active courses</h2>
                <div class="blocks" th:if="!${#lists.isEmpty(availableActive)}">
                    <th:block th:each="course : ${availableActive}">
                        <th:block>
                            <a
                                class="block"
                                th:href="@{|/edition/${@courseService.getLastEditionForCourse(course.id)}|}">
                                <h2 th:text="${course.code}"></h2>
                                <h2 th:text="${course.name}"></h2>
                                <h3
                                    style="font-size: 0.8rem"
                                    th:text="|${@skillRepository.countBySubmoduleModuleEditionId(@courseService.getLastEditionForCourse(course.id))} skills|"></h3>
                            </a>
                        </th:block>
                    </th:block>
                </div>

                <h2 th:if="!${#lists.isEmpty(availableFinished)}">Finished courses</h2>
                <div class="blocks" th:if="!${#lists.isEmpty(availableFinished)}">
                    <th:block th:each="course : ${availableFinished}">
                        <th:block>
                            <a
                                class="block"
                                th:href="@{|/edition/${@courseService.getLastEditionForCourse(course.id)}|}">
                                <h2 th:text="${course.code}"></h2>
                                <h2 th:text="${course.name}"></h2>
                                <h3
                                    style="font-size: 0.8rem"
                                    th:text="|${@skillRepository.countBySubmoduleModuleEditionId(@courseService.getLastEditionForCourse(course.id))} skills|"></h3>
                            </a>
                        </th:block>
                    </th:block>
                </div>
            </div>

            <!-- TODO conditions, move to fragment -->
            <script>
                function setCourseView(view) {
                    const ownCourses = $("#own-courses");
                    const availableCourses = $("#available-courses");

                    if (view === "own") {
                        ownCourses.css("display", "");
                        ownCourses.removeAttr("aria-hidden");
                        ownCourses.data("active", true);

                        availableCourses.css("display", "none");
                        availableCourses.attr("aria-hidden", "true");
                        availableCourses.data("active", false);
                    } else if (view === "available") {
                        availableCourses.css("display", "");
                        availableCourses.removeAttr("aria-hidden");
                        availableCourses.data("active", true);

                        ownCourses.css("display", "none");
                        ownCourses.attr("aria-hidden", "true");
                        ownCourses.data("active", false);
                    }
                }
            </script>
        </div>
    </body>
</html>
