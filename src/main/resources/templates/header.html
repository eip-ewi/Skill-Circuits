<!--

    Skill Circuits
    Copyright (C) 2022 - Delft University of Technology

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!DOCTYPE html>
<html
    lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <header layout:fragment="header" class="header">
        <h1 class="header__title"><a th:href="@{/}">Skill Circuits</a></h1>

        <nav aria-label="primary" class="header__links"></nav>

        <ul class="header__icons">
            <li
                class="header__icon header__button"
                th:unless="${@authorisationService.isAuthenticated()}">
                <a th:href="@{/auth/login}">
                    <span class="fa-solid fa-right-to-bracket"></span>
                    Login
                </a>
            </li>
            <li th:if="${@authorisationService.isAuthenticated()}">
                <!--TODO: and isResearchParticipant -->
                <button class="header__button" id="playlist-button">
                    <span class="fa-solid fa-circle-play"></span>
                    <span>Playlist</span>
                </button>
                <ul
                    th:if="${@authorisationService.isAuthenticated()}"
                    class="header__dropdown"
                    id="playlist">
                    <!--                <th:block-->
                    <!--                        th:if="${@authorisationService.isAuthenticated()} and not ${@authorisationService.canViewCourse(course.id)} and ${completedSkillsPerCourse.get(course.id)} > 0">-->
                    <li>
                        <th:block
                            th:with="path='Your default path: ' + ${@playlistService.getDefaultPathForEdition(@authorisationService.getAuthPerson().getId())}">
                            <span class="fa-solid fa-road"></span>
                            <span th:text="${path}"></span>
                        </th:block>
                    </li>
                    <th:block
                        th:with="items =  ${@playlistService.getSkills(@authorisationService.getAuthPerson().getId(), 13)}">
                        <li th:each="skill : ${items.entrySet()}">
                            <span class="fa-solid circle"></span>
                            <span th:text="${skill.getKey().getName()}"></span>
                            <ul class="header__icons" style="display: block">
                                <li th:each="task : ${skill.getValue().entrySet()}">
                                    <a
                                        th:href="@{'/module/' + ${task.getValue().get(0)} +
                                        '#block-' + ${skill.getKey().getId()}}">
                                        <span class="fa-solid fa-square"></span>
                                        <!--Strikethrough the text if the task has already been done -->
                                        <span th:style="${task.getValue().get(1) == 1? 'text-decoration: line-through;' : ''}"
                                            th:text="${@playlistService.getTaskName(task.getKey())}"></span>
                                        <!-- TODO: Add playing or something -->
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li><span>=========</span></li>
                        <li>
                            <span class="fa-solid fa-bullseye"></span>
                            <span th:text="'Checkpoint: Lecture 1'"></span>
                        </li>
                    </th:block>
                    <!--            </th:block>-->
                </ul>
            </li>
            <li class="header__icon" th:if="${@authorisationService.isAuthenticated()}">
                <button class="header__button" id="dropdown-button">
                    <span th:text="${@authorisationService.getAuthPerson().displayName}"></span>
                    <span id="dropdown-icon" class="fa-solid fa-angle-down"></span>
                </button>
                <ul id="dropdown" class="header__dropdown">
                    <li>
                        <a th:href="@{/}">
                            <span class="fa-solid fa-user"></span>
                            Your Profile
                        </a>
                    </li>
                    <li>
                        <a th:href="@{/inventory}">
                            <span class="fa-solid fa-boxes-stacked"></span>
                            Inventory
                        </a>
                    </li>
                    <li>
                        <form th:action="@{/auth/logout}" method="post">
                            <button type="submit">
                                <span class="fa-solid fa-right-from-bracket"></span>
                                Logout
                            </button>
                        </form>
                    </li>
                </ul>
            </li>
        </ul>
    </header>
</html>
